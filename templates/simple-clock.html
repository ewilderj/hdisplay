<div
  style="
    display: flex;
    flex-direction: column;
    justify-content: center;
    align-items: center;
    width: 100%;
    height: 100%;
    font-family: 'Courier New', 'Monaco', 'Menlo', 'Ubuntu Mono', monospace;
    font-weight: bold;
    text-shadow: 0 0 10px currentColor;
    color: #00ff00;
    background: #000;
  "
>
  <div id="sc-time" style="font-size: 120px; line-height: 1"></div>
</div>
<script>
  (function () {
    const timeEl = document.getElementById('sc-time');

    const rawTime = String.raw`{{ time }}`.trim();
    const useMachineRaw = String.raw`{{ useMachine }}`.trim();

    let useMachine = useMachineRaw === 'true';
    // Default to machine time when no explicit time provided
    if (!useMachine && !rawTime) {
      useMachine = true;
    }

    function formatNow() {
      const now = new Date();
      const time = now.toLocaleTimeString(undefined, { hour: '2-digit', minute: '2-digit' });
      return time;
    }

    function render() {
      if (useMachine) {
        const time = formatNow();
        timeEl.textContent = time;
      } else {
        timeEl.textContent = rawTime || '';
      }
    }

    render();
    if (useMachine) {
      const clockInterval = setInterval(render, 1000);
      
      // Cleanup interval when page unloads or template changes
      window.addEventListener('beforeunload', () => clearInterval(clockInterval));
      
      // Store interval globally so it can be cleared by new templates
      if (window.hdisplay) {
        if (window.hdisplay.clockInterval) {
          clearInterval(window.hdisplay.clockInterval);
        }
        window.hdisplay.clockInterval = clockInterval;
      }
    }
  })();
</script>
